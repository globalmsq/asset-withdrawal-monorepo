# Task ID: 11
# Title: signing-service Multicall3 배치 전송 기능 구현
# Status: in-progress
# Dependencies: None
# Priority: high
# Description: ERC20 토큰 배치 전송을 위한 Multicall3 통합 기능 구현
# Details:
Multicall3 컨트랙트 주소 설정 (Polygon: 0xcA11bde05977b3631167028862bE2a173976CA11), MulticallService 클래스 구현으로 여러 ERC20 전송을 하나의 트랜잭션으로 배치 처리, TransactionSigner에 signBatchTransaction() 메서드 추가, WithdrawalRequest 모델에 type 필드 추가 ('SINGLE' | 'BATCH'), ABI 인코딩 및 calldata 생성 로직 구현, 배치 크기 최적화 (가스 한도 내에서 최대 전송 수 계산)

# Test Strategy:
Multicall3 컨트랙트 호출 테스트, 배치 전송 가스 계산 정확성 검증, 단일 vs 배치 전송 성능 비교 테스트, 최대 배치 크기 한계 테스트, 실패 시나리오 (가스 부족, 잘못된 토큰 주소) 테스트

# Subtasks:
## 1. Polygon Multicall3 컨트랙트 주소 설정 [pending]
### Dependencies: None
### Description: Polygon 네트워크의 Multicall3 컨트랙트 주소를 환경 설정에 추가하고 네트워크별 구성 관리
### Details:
환경 변수에 Multicall3 컨트랙트 주소 (0xcA11bde05977b3631167028862bE2a173976CA11) 추가, 네트워크별 주소 매핑 구성, 환경 설정 검증 로직 구현

## 2. MulticallService 클래스 구현 [pending]
### Dependencies: 11.1
### Description: 여러 ERC20 전송을 하나의 트랜잭션으로 배치 처리하는 MulticallService 핵심 클래스 개발
### Details:
MulticallService 클래스 구조 설계, 배치 전송 요청 처리 메서드, Multicall3 컨트랙트와의 인터페이스 구현, 에러 핸들링 로직 추가

## 3. ABI 인코딩 및 calldata 생성 로직 구현 [pending]
### Dependencies: 11.2
### Description: ERC20 전송을 위한 ABI 인코딩과 Multicall3용 calldata 생성 로직 개발
### Details:
ERC20 transfer 함수 ABI 인코딩, Multicall3 aggregate 함수를 위한 calldata 배열 생성, 인코딩 정확성 검증, 바이트 데이터 최적화

## 4. 배치 크기 최적화 로직 구현 [pending]
### Dependencies: 11.3
### Description: 가스 한도 내에서 최대 전송 수를 계산하는 배치 크기 최적화 기능 개발
### Details:
가스 사용량 추정 로직, 블록 가스 한도 대비 최적 배치 크기 계산, 동적 배치 크기 조정 알고리즘, 가스비 효율성 분석

## 5. TransactionSigner 확장 및 배치 서명 기능 추가 [pending]
### Dependencies: 11.4
### Description: 기존 TransactionSigner에 signBatchTransaction() 메서드를 추가하여 배치 트랜잭션 서명 지원
### Details:
signBatchTransaction() 메서드 구현, 단일 트랜잭션과 배치 트랜잭션 서명 로직 통합, nonce 관리 개선, 서명 검증 로직 추가

## 6. 데이터 모델 업데이트 및 통합 테스트 [pending]
### Dependencies: 11.5
### Description: WithdrawalRequest 모델에 type 필드 추가 및 전체 Multicall3 기능 통합 테스트 수행
### Details:
WithdrawalRequest 모델에 type: 'SINGLE' | 'BATCH' 필드 추가, 데이터베이스 스키마 업데이트, 단일/배치 전송 통합 테스트, 성능 비교 테스트 수행

